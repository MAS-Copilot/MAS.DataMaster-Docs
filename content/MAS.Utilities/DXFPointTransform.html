<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>图纸坐标系建立与转换 | DataMaster </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="图纸坐标系建立与转换 | DataMaster ">
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/MAS-Copilot/mas-data-master/blob/main/docs/content/MAS.Utilities/DXFPointTransform.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../images/logo.svg" alt="DataMaster">
            DataMaster
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="图纸坐标系建立与转换">图纸坐标系建立与转换</h1>

<h2 id="前言">前言</h2>
<p>图纸导入系统解析 DXF 文件中的 2D 点位，并将这些点位发送给 PLC、机器人或运动控制器执行。DXF 文件基于 CAD 的世界坐标系，而实际执行机构（机器人臂或运动平台）可能使用户坐标系、工具坐标系或世界坐标系。关键问是建立这些坐标系之间的关系</p>
<p>目前，采用相对位置方式：图纸设定原点，实际位置减去原点得到相对坐标，这种方法简单有效，但在复杂场景下需要扩展到坐标变换，文档中解释如何确定和建立坐标系关系，下发点位是否可直接执行，以及步骤，针对 2D 图纸（平面坐标，忽略 Z 轴）</p>
<h2 id="坐标系概述">坐标系概述</h2>
<p>在 2D 系统中，坐标系包括：</p>
<ul>
<li><strong>世界坐标系</strong>：全局固定参考系，通常基于 CAD 图纸或物理环境（如工作台原点）。DXF 点位 <span class="math">\(P_w = (x_w, y_w)\)</span> 默认在此坐标系中，<span class="math">\(x_w, y_w\)</span> 表示点在图纸中的 X、Y 坐标</li>
<li><strong>用户坐标系</strong>：自定义参考系，基于实际工件或工作台的局部坐标，用于适应不同物体放置位置。点表示为 <span class="math">\(P_t = (x_t, y_t)\)</span></li>
<li><strong>工具坐标系</strong>：执行机构（如机器人末端工具）的局部坐标系，可能有偏移或旋转，点同样表示为 <span class="math">\(P_t = (x_t, y_t)\)</span></li>
</ul>
<p>这些坐标系间的关系通过变换矩阵建立。在 2D 中，变换包括平移和旋转，用 3x3 齐次矩阵表示：</p>
<div class="math">
\[
T = \begin{bmatrix}
\cos\theta &amp; -\sin\theta &amp; t_x \\
\sin\theta &amp; \cos\theta &amp; t_y \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<p>其中，<span class="math">\(\theta\)</span> 是旋转角度（弧度），<span class="math">\(t_x, t_y\)</span> 是平移量（单位：与图纸一致，默认毫米）</p>
<h2 id="相对位置方式">相对位置方式</h2>
<p>当前实现：</p>
<ul>
<li>在图纸中设定一个原点 <span class="math">\(O = (x_0, y_0)\)</span>（例如图纸左下角或特征点）</li>
<li>对每个点位 <span class="math">\(P_w = (x_w, y_w)\)</span>（世界坐标），计算相对坐标 <span class="math">\(P_{rel} = (x_w - x_0, y_w - y_0)\)</span></li>
<li>下发 <span class="math">\(P_{rel}\)</span> 给执行机构，但执行机构需要已标定到该相对原点</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>简单，无需复杂矩阵计算</li>
<li>适用于静态场景，如固定工件位置</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>若工件旋转或偏移，相对坐标无效</li>
<li>不支持用户/工具坐标的动态切换</li>
<li>需手动调整原点，易出错</li>
</ul>
<p><strong>下发点位直接执行：</strong></p>
<p>若执行机构（如龙门架）的原点与相对原点物理对齐且无旋转，可直接执行 <span class="math">\(P_{rel}\)</span>。否则，需坐标变换</p>
<h2 id="坐标关系建立">坐标关系建立</h2>
<p>通过标定建立世界坐标系与用户/工具坐标系的变换矩阵</p>
<h3 id="step-1标定坐标系">Step 1：标定坐标系</h3>
<ol>
<li><strong>选择参考点</strong>：
<ul>
<li>在物理环境中选择三个非共线点，以确定唯一的 2D 变换</li>
<li><strong>推荐点</strong>：
<ul>
<li>工件上的角点（如矩形工件的三个顶点）</li>
<li>工装上的标记点（如 ARUCO 标记、激光刻点）</li>
<li>工作台上的固定参考点（如校准孔、边缘点）</li>
</ul>
</li>
<li><strong>要求</strong>：
<ul>
<li><strong>非共线</strong>：三个点必须形成三角形（面积非零），验证公式：
<div class="math">
\[
\text{Area} = \frac{1}{2} \left| (x_B - x_A)(y_C - y_A) - (y_B - y_A)(x_C - x_A) \right| &gt; 1e-6
\]</div>
</li>
<li><strong>对应性</strong>：图纸点和物理点必须一一对应（图纸点 A 对应物理点 A'）</li>
<li><strong>分散性</strong>：点尽量分散（如工件尺寸的 50% 以上），以减少误差放大</li>
<li><strong>可测量性</strong>：物理点需易于定位（如显著特征点）</li>
<li><strong>存在图纸</strong>：在有图纸时，点必须在 DXF 中有明确坐标（无需特别标注，只需提取，如线端点）。无图纸时，手动设定世界坐标点作为临时参考</li>
</ul>
</li>
<li><strong>示例</strong>：
<ul>
<li>图纸点：A(0,0), B(100,0), C(0,50)（毫米，矩形工件三个顶点）</li>
<li>物理点：A'(0.1,0.2), B'(100.1,0.2), C'(0.1,50.2)（测量得到）</li>
<li>无图纸时：手动设 A(0,0), B(100,0), C(0,50) 为临时世界点，测量物理对应点</li>
</ul>
</li>
</ul>
</li>
<li><strong>计算矩阵变换</strong>：
<ul>
<li>构建源坐标矩阵 ( src ) 和目标坐标矩阵 ( dst )，点以列向量形式表示（齐次坐标）：
<div class="math">
\[
   src = \begin{bmatrix} x_{w1} &amp; x_{w2} &amp; x_{w3} \\ y_{w1} &amp; y_{w2} &amp; y_{w3} \\ 1 &amp; 1 &amp; 1 \end{bmatrix},
   \quad dst = \begin{bmatrix} x_{t1} &amp; x_{t2} &amp; x_{t3} \\ y_ {t1} &amp; y_{t2} &amp; y_{t3} \\ 1 &amp; 1 &amp; 1 \end{bmatrix}
\]</div>
</li>
<li>使用公式 <span class="math">\(T = dst \cdot src^{-1}\)</span> 求解 3x3 变换矩阵 <span class="math">\(T\)</span>，使得 <span class="math">\(P_t = T \cdot P_w\)</span>（<a href="https://zh.wikipedia.org/zh-hans/%E9%BD%90%E6%AC%A1%E5%9D%90%E6%A0%87">齐次形式</a>）</li>
</ul>
</li>
</ol>
<h3 id="step-2转换点位">Step 2：转换点位</h3>
<p>对于 DXF 解析的点位 <span class="math">\(P_w = (x_w, y_w)\)</span>，转换为目标坐标 <span class="math">\(P_t = (x_t, y_t)\)</span> 的公式：<span class="math">\(P_t = T \cdot \begin{bmatrix} x_w \ y_w \ 1 \end{bmatrix}\)</span></p>
<h3 id="step-3下发点位">Step 3：下发点位</h3>
<ul>
<li>转换后点位：<span class="math">\(P_t = (x_t, y_t)\)</span> 可通过通信协议发送给执行机构</li>
<li>坐标系对齐：
<ul>
<li>若执行机构坐标系（如机器人工具坐标系）与目标坐标系（用户坐标系）存在偏移（例如，工具中心点 TCP 相对于法兰有平移 <span class="math">\((dx, dy)\)</span> 或旋转 <span class="math">\(\phi\)</span>，直接下发 <span class="math">\(P_t\)</span> 会导致定位错误</li>
<li>校准方法：
<ul>
<li>测量偏移：通过物理测量（激光测距）或视觉系统（如摄像头 + ARUCO 标记）确定 <span class="math">\((dx, dy, \phi)\)</span></li>
<li>构建补偿矩阵：
<div class="math">
\[
  T_{offset} = \begin{bmatrix}
  \cos\phi &amp; -\sin\phi &amp; dx \\
  \sin\phi &amp; \cos\phi &amp; dy \\
  0 &amp; 0 &amp; 1
  \end{bmatrix}
\]</div>
</li>
<li>应用补偿：将 <span class="math">\(P_t\)</span> 转换为执行机构坐标 <span class="math">\(P_{exec}\)</span>：
<div class="math">
\[
  P_{exec} = T_{offset} \cdot \begin{bmatrix} x_t \ y_t \ 1 \end{bmatrix}
\]</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="互转实现">互转实现</h2>
<ul>
<li>世界到用户/工具：使用变换矩阵 <span class="math">\(T\)</span></li>
<li>用户/工具到世界：使用逆矩阵 <span class="math">\(T^{-1}\)</span></li>
<li>链式转换：若涉及多坐标系（世界 → 用户 → 工具），计算复合矩阵： <span class="math">\(T_{total} = T_{user \to tool} \cdot T_{world \to user}\)</span></li>
</ul>
<h2 id="结语">结语</h2>
<p>通过标定和<code>3*3</code>矩阵转换，可从相对位置升级到全坐标变换，支持复杂场景。下发点位经转换后可直接执行，减少手动干预。<code>3D</code>扩展需<code>4x4</code>矩阵和<code>3D</code>图纸导入功能的支持</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/MAS-Copilot/mas-data-master/blob/main/docs/content/MAS.Utilities/DXFPointTransform.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx" rel="noreferrer">docfx</a>,  | Copyright (c) MAS(厦门威光) Corporation. All rights reserved.</span>
        </div>
      </div>
    </footer>
  </body>
</html>
